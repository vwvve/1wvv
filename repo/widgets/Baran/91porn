function t(t){let e=[];for(let r=0;r<t.length;r++){let i=t[r];i&&e.push(i)}return e}function e(t){if(!t||"object"!=typeof t)return!1;let e=Object.getPrototypeOf(t);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&"[object Object]"===Object.prototype.toString.call(t)}function r(t,i){let l=Object.keys(i);for(let o=0;o<l.length;o++){let a=l[o];if("__proto__"===a)continue;let n=i[a],u=t[a];Array.isArray(n)?Array.isArray(u)?t[a]=r(u,n):t[a]=r([],n):e(n)?e(u)?t[a]=r(u,n):t[a]=r({},n):(void 0===u||void 0!==n)&&(t[a]=n)}return t}const i={"Accept-Language":"zh-CN,zh;q=0.9,zh-TW;q=0.8,en;q=0.7"},l="https://91porn.com",o=new class{async get(t,e){let l={headers:i};if(this.getDefaultOptions)try{let t=await this.getDefaultOptions();l=r(l,null!=t?t:{})}catch(t){console.warn("获取默认配置失败，使用基础配置:",t)}let o=r(l,null!=e?e:{});try{let e=await Widget.http.get(t,o);if(!e||200!==e.statusCode)throw Error(`\u{8BF7}\u{6C42}\u{5931}\u{8D25}: ${(null==e?void 0:e.statusCode)||"未知错误"}`);return e.data}catch(t){throw Error(`\u{7F51}\u{7EDC}\u{8BF7}\u{6C42}\u{5931}\u{8D25}: ${t instanceof Error?t.message:"未知错误"}`)}}async getHtml(t,e){let r=await this.get(t,e);return Widget.html.load(r)}constructor(t){var e,r;r=void 0,(e="getDefaultOptions")in this?Object.defineProperty(this,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[e]=r,this.getDefaultOptions=t}};WidgetMetadata = {id:"nsfw.91porn",title:"91Porn",description:"\uD83D\uDD1E 91Porn 视频搜索",author:"匿名",version:"0.10.1",requiredVersion:"0.0.1",site:"https://github.com/baranwang/forward-widgets/tree/main/packages/nsfw",detailCacheDuration:1,globalParams:[{name:"base_url",title:"基础 URL",type:"input",value:l}],modules:[{id:"91porn.list",title:"\uD83D\uDD1E 91Porn 视频搜索",description:"\uD83D\uDD1E 91Porn 视频搜索",cacheDuration:3600,requiresWebView:!1,functionName:"get91pornList",params:[{name:"sort_by",title:"分类",description:"分类",type:"enumeration",value:"rf",enumOptions:[{value:"rf",title:"最近加精"},{value:"hot",title:"当前最热"},{value:"top",title:"本月最热"},{value:"tf",title:"本月收藏"},{value:"md",title:"本月讨论"},{value:"top&m=-1",title:"上月最热"},{value:"ori",title:"91原创"},{value:"long",title:"10分钟以上 "},{value:"longer",title:"20分钟以上 "},{value:"hd",title:"高清"},{value:"mf",title:"收藏最多"}]},{name:"page",title:"页码",type:"page",value:"1"}]}]},get91pornList=async e=>{e.sort_by||(e.sort_by="ori"),e.page||(e.page="1"),e.base_url||(e.base_url=l);try{let r=await o.getHtml(`${e.base_url}/v.php?category=${e.sort_by}&viewtype=basic&page=${e.page}`);if(!r)return[];let i=Array.from(r(".videos-text-align")).map(t=>{var e,i;let l=r(t);if(l.closest(".col-lg-8").length>0)return console.debug("跳过蜜罐"),null;let o=l.find("a").attr("href");if(!o)return console.debug("跳过没有链接的元素"),null;let a=l.find(".img-responsive").attr("src"),n={id:o,type:"url",mediaType:"movie",link:o,title:l.find(".video-title").text().trim(),backdropPath:a};try{n.durationText=l.find(".duration").text().trim()}catch(t){}try{let t=null==a||null==(e=a.split("/").pop())?void 0:e.split(".").shift();t&&(n.previewUrl=`https://vthumb.killcovid2021.com/thumb/${t}.mp4`)}catch(t){}try{let t=null==(i=l.find(".info").filter((t,e)=>r(e).text().includes("添加时间"))[0])?void 0:i.nextSibling,e=t&&"textContent"in t?t.textContent:void 0;e&&"string"==typeof e&&(n.releaseDate=e.trim())}catch(t){}return n});return t(i)}catch(t){return console.error("Failed to get 91porn list",t),[]}},loadDetail=async e=>{try{var r;let i=await o.getHtml(e);if(!i)throw Error("未找到视频资源");let l=i("#player_one"),a=l.find("script").text(),n=decodeURIComponent((null==(r=a.match(/strencode2\("(.*?)"\)/))?void 0:r[1])||""),u=(await Widget.html.load(n))("source").attr("src");if(!u)throw Error("未找到视频资源");let s={id:e,type:"detail",mediaType:"movie",link:e,title:i("#videodetails h4").first().text().trim(),backdropPath:l.attr("poster"),videoUrl:u};try{let t=i("#useraction").find(".info").filter((t,e)=>i(e).text().includes("时长")).find(".video-info-span").text().trim();t&&(s.durationText=t)}catch(t){}try{let t=i(".title-yakov").eq(0).text();t&&(s.releaseDate=t)}catch(t){}try{let t=(await Widget.html.load(i("#v_desc").html().replace(/<br\s*\/?>/g,"\n"))).text();t&&(s.description=t)}catch(t){}try{s.childItems=t(Array.from(i(".well")).map(t=>{let e=i(t),r=e.find("a").attr("href");if(!r)return null;let l=e.find(".video-title").text().trim(),o=e.find(".duration").text().trim();return{id:r,type:"url",mediaType:"movie",link:r,title:l,durationText:o,backdropPath:e.find(".img-responsive").attr("src")}}))}catch(t){}return s}catch(t){return console.error("Failed to load detail",t),null}};