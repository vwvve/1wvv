function t(t){let e=[];for(let r=0;r<t.length;r++){let i=t[r];i&&e.push(i)}return e}function e(t){if(!t||"object"!=typeof t)return!1;let e=Object.getPrototypeOf(t);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&"[object Object]"===Object.prototype.toString.call(t)}function r(t,i){let l=Object.keys(i);for(let o=0;o<l.length;o++){let n=l[o];if("__proto__"===n)continue;let a=i[n],u=t[n];Array.isArray(a)?Array.isArray(u)?t[n]=r(u,a):t[n]=r([],a):e(a)?e(u)?t[n]=r(u,a):t[n]=r({},a):(void 0===u||void 0!==a)&&(t[n]=a)}return t}function i(t,e,r,i,l,o,n){try{var a=t[o](n),u=a.value}catch(t){r(t);return}a.done?e(u):Promise.resolve(u).then(i,l)}function l(t){return function(){var e=this,r=arguments;return new Promise(function(l,o){var n=t.apply(e,r);function a(t){i(n,l,o,a,u,"next",t)}function u(t){i(n,l,o,a,u,"throw",t)}a(void 0)})}}let o={"Accept-Language":"zh-CN,zh;q=0.9,zh-TW;q=0.8,en;q=0.7"};function n(t,e,r,i,l,o,n){try{var a=t[o](n),u=a.value}catch(t){r(t);return}a.done?e(u):Promise.resolve(u).then(i,l)}function a(t){return function(){var e=this,r=arguments;return new Promise(function(i,l){var o=t.apply(e,r);function a(t){n(o,i,l,a,u,"next",t)}function u(t){n(o,i,l,a,u,"throw",t)}a(void 0)})}}let u="https://91porn.com",s=new class{get(t,e){return l(function*(){let i={headers:o};if(this.getDefaultOptions)try{let t=yield this.getDefaultOptions();i=r(i,null!=t?t:{})}catch(t){console.warn("获取默认配置失败，使用基础配置:",t)}let l=r(i,null!=e?e:{});try{let e=yield Widget.http.get(t,l);if(!e||200!==e.statusCode)throw Error(`请求失败: ${(null==e?void 0:e.statusCode)||"未知错误"}`);return e.data}catch(t){throw Error(`网络请求失败: ${t instanceof Error?t.message:"未知错误"}`)}}).call(this)}getHtml(t,e){return l(function*(){let r=yield this.get(t,e);return Widget.html.load(r)}).call(this)}constructor(t){var e,r;r=void 0,(e="getDefaultOptions")in this?Object.defineProperty(this,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[e]=r,this.getDefaultOptions=t}};WidgetMetadata = {id:"nsfw.91porn",title:"91Porn",description:"\uD83D\uDD1E 91Porn 视频搜索",author:"匿名",version:"0.10.2",requiredVersion:"0.0.1",site:"https://github.com/baranwang/forward-widgets/tree/main/apps/nsfw",detailCacheDuration:1,globalParams:[{name:"base_url",title:"基础 URL",type:"input",value:u}],modules:[{id:"91porn.list",title:"\uD83D\uDD1E 91Porn 视频搜索",description:"\uD83D\uDD1E 91Porn 视频搜索",cacheDuration:3600,requiresWebView:!1,functionName:"get91pornList",params:[{name:"sort_by",title:"分类",description:"分类",type:"enumeration",value:"rf",enumOptions:[{value:"rf",title:"最近加精"},{value:"hot",title:"当前最热"},{value:"top",title:"本月最热"},{value:"tf",title:"本月收藏"},{value:"md",title:"本月讨论"},{value:"top&m=-1",title:"上月最热"},{value:"ori",title:"91原创"},{value:"long",title:"10分钟以上 "},{value:"longer",title:"20分钟以上 "},{value:"hd",title:"高清"},{value:"mf",title:"收藏最多"}]},{name:"page",title:"页码",type:"page",value:"1"}]},{type:"stream",id:"loadResource",title:"加载资源",functionName:"loadResource"}]},get91pornList=e=>a(function*(){e.sort_by||(e.sort_by="ori"),e.page||(e.page="1"),e.base_url||(e.base_url=u);try{let r=yield s.getHtml(`${e.base_url}/v.php?category=${e.sort_by}&viewtype=basic&page=${e.page}`);if(!r)return[];let i=Array.from(r(".videos-text-align")).map(t=>{var e,i;let l=r(t);if(l.closest(".col-lg-8").length>0)return console.debug("跳过蜜罐"),null;let o=l.find("a").attr("href");if(!o)return console.debug("跳过没有链接的元素"),null;let n=l.find(".img-responsive").attr("src"),a={id:o,type:"url",mediaType:"movie",link:o,title:l.find(".video-title").text().trim(),backdropPath:n};try{a.durationText=l.find(".duration").text().trim()}catch(t){}try{let t=null==n||null==(e=n.split("/").pop())?void 0:e.split(".").shift();t&&(a.previewUrl=`https://vthumb.killcovid2021.com/thumb/${t}.mp4`)}catch(t){}try{let t=null==(i=l.find(".info").filter((t,e)=>r(e).text().includes("添加时间"))[0])?void 0:i.nextSibling,e=t&&"textContent"in t?t.textContent:void 0;e&&"string"==typeof e&&(a.releaseDate=e.trim())}catch(t){}return a});return t(i)}catch(t){return console.error("Failed to get 91porn list",t),[]}})(),loadDetail=e=>a(function*(){try{var r;let i=yield s.getHtml(e);if(!i)throw Error("未找到视频资源");let l=i("#player_one"),o=l.find("script").text(),n=decodeURIComponent((null==(r=o.match(/strencode2\("(.*?)"\)/))?void 0:r[1])||""),a=(yield Widget.html.load(n))("source").attr("src");if(!a)throw Error("未找到视频资源");let u={id:e,type:"detail",mediaType:"movie",link:e,title:i("#videodetails h4").first().text().trim(),backdropPath:l.attr("poster"),videoUrl:a};try{let t=i("#useraction").find(".info").filter((t,e)=>i(e).text().includes("时长")).find(".video-info-span").text().trim();t&&(u.durationText=t)}catch(t){}try{let t=i(".title-yakov").eq(0).text();t&&(u.releaseDate=t)}catch(t){}try{let t=(yield Widget.html.load(i("#v_desc").html().replace(/<br\s*\/?>/g,"\n"))).text();t&&(u.description=t)}catch(t){}try{u.childItems=t(Array.from(i(".well")).map(t=>{let e=i(t),r=e.find("a").attr("href");if(!r)return null;let l=e.find(".video-title").text().trim(),o=e.find(".duration").text().trim();return{id:r,type:"url",mediaType:"movie",link:r,title:l,durationText:o,backdropPath:e.find(".img-responsive").attr("src")}}))}catch(t){}return u}catch(t){return console.error("Failed to load detail",t),null}})(),loadResource=t=>a(function*(){var e;let{id:r,link:i,videoUrl:l,base_url:o=u}=t,n=[r,i,l].find(t=>null==t?void 0:t.startsWith(o));if(!n)return[];let a=yield loadDetail(n);return[{name:a.title,description:null!=(e=a.description)?e:"",url:a.videoUrl}]})();